# Интеграционные тесты

Интеграционные тесты используют реальный test API T-Bank для проверки работы библиотеки с реальным сервером.

## Настройка

Тестовые данные терминала хранятся в файле `.env` в корне проекта.

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Заполните файл `.env` тестовыми данными:

- `TEST_TERMINAL` - номер тестового терминала
- `TEST_SECRET` - секретный ключ терминала
- `TEST_API_URL` - URL API (по умолчанию `https://securepay.tinkoff.ru`, можно не указывать)

**Важно:**

- Тестовый терминал с приставкой `DEMO` должен отправлять запросы на боевую среду
- Файл `.env` не должен попадать в репозиторий (уже добавлен в `.gitignore`)

## Запуск

```bash
npm run test:integration
```

## Структура тестов

- `payment.test.js` - тесты создания платежей и проверки статуса
- `customers.test.js` - тесты работы с клиентами
- `cards.test.js` - тесты работы с картами
- `sbp.test.js` - тесты СБП методов
- `alternative-payments.test.js` - тесты T-Pay, SberPay, Mir Pay
- `3ds.test.js` - тесты методов 3DS
- `receipts.test.js` - тесты работы с чеками
- `operation-reference.test.js` - тесты получения справок

## Особенности

- Интеграционные тесты могут быть нестабильными из-за внешнего API
- Таймаут увеличен до 60 секунд
- Тесты не останавливаются на первой ошибке (`bail: false`)
- Некоторые тесты могут падать в зависимости от настроек терминала

## Тестовые данные

Используются тестовые данные из `lib/test-data/test-scenarios.js`:

- Тестовые карты
- Сценарии СБП
- Коды ошибок
